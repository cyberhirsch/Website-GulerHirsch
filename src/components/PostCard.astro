---
export interface Props {
  count: number;
  post: any; // using any for now, better to use CollectionEntry
  slug: string;
}

const { count, post, slug } = Astro.props;
const thumbnail = post.data.thumbnail;
const title = post.data.title;
const isLarge = count % 3 === 0;

// Construct background image style
const finalThumbnail = thumbnail && thumbnail.startsWith('/') ? `${import.meta.env.BASE_URL}/${thumbnail.slice(1)}`.replace(/\/+/g, '/') : thumbnail;
const bgStyle = thumbnail ? `background-image: url(${finalThumbnail});` : '';
const postClass = `post-card ${isLarge ? 'post-card-large' : ''} ${thumbnail ? 'with-image' : 'no-image'} post`;
---

<article class={postClass} style={bgStyle}>
  <a href={`${import.meta.env.BASE_URL}/${slug}`.replace(/\/+/g, '/')} class="post-card-link">
    <div class="post-card-content">
      <h2 class="post-card-title">
        {title}
      </h2>
    </div>
  </a>
</article>

<style>
/* Post Feed */
.post-card {
  position: relative;
  flex: 1 0 30%;
  display: flex;
  aspect-ratio: 1 / 1.1;
  background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%) center center;
  background-size: cover;
  background-position: center center;
  overflow: hidden;
  margin: 1rem;
  border-radius: 4px; /* Sharper, more premium feel */
  transition: transform 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
}

[data-theme='dark'] .post-card {
  background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%) center center;
}

.post-card:hover {
  transform: translateY(-4px);
}

@media (max-width: 900px) {
  .post-card {
    flex: 1 1 45%;
  }
}

@media (max-width: 600px) {
  .post-card {
    flex: 1 1 100%;
    margin: 1rem 0;
  }
}

.post-card-large {
  flex: 1 1 100%;
  aspect-ratio: 16 / 9;
}

@media (max-width: 700px) {
  .post-card-large {
    aspect-ratio: 4 / 3;
  }
}

.post-card-link {
  flex: 1 1 auto;
  display: flex;
  text-decoration: none;
}

.post-card-content {
  flex: 1 1 auto;
  display: flex;
  align-items: flex-end; /* Title at bottom for a gallery feel */
  justify-content: center;
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  color: #fff;
  background: linear-gradient(to top, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0) 40%);
  opacity: 0;
  transition: opacity 0.4s ease;
  padding: 2rem;
}

.post-card.no-image .post-card-content {
  opacity: 1;
  background: rgba(0, 0, 0, 0.05);
  color: var(--color-base);
  align-items: center;
}

.post-card-link:hover .post-card-content {
  opacity: 1;
}

.post-card-title {
  margin: 0;
  font-size: 2.2rem;
  text-align: center;
  font-family: var(--font-sans-serif);
  font-weight: 400;
  letter-spacing: 2px;
  text-transform: uppercase;
}

.post-card.no-image .post-card-title {
  text-shadow: none;
  font-size: 3rem;
  opacity: 0.8;
}

@media (max-width: 700px) {
  .post-card-title {
    font-size: 1.8rem;
  }
}
</style>
